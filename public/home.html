<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Telegram Mini App Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
  </head>
  <body>
    <button id="searchGameButton">Search for Game</button>
    <p id="status"></p>
    <p id="opponentMove"></p>
    <button id="moveButton">Play Move</button>

    <script>
      // Connect to the Socket.IO server
      const socket = io("https://17a5-37-19-205-215.ngrok-free.app"); // Replace with your NestJS server URL
      console.log("start console");
      // Wait for the Telegram Mini App to be ready
      Telegram.WebApp.ready(() => {
        console.log("start ready");

        const user = Telegram.WebApp.initDataUnsafe.user;
        const chatId = Telegram.WebApp.initDataUnsafe.user.id;
        console.log(chatId);

        // Search for a game
        document
          .getElementById("searchGameButton")
          .addEventListener("click", () => {
            socket.emit("searchGame", { chatId: user.id });
          });

        // Handle waiting for an opponent
        socket.on("waiting", (data) => {
          console.log(data.message); // Log waiting message
          document.getElementById("status").innerText = data.message;
        });

        // Handle game start
        socket.on("gameStart", (data) => {
          console.log("Game started in room:", data.room);
          document.getElementById("status").innerText = "Game started!";

          // Here you can implement your game logic for both players
        });
        socket.on("connect", () => {
          // Emit an event to send the chat ID when the socket connects
          socket.emit("registerChatId", { chatId });
        });
        // Send a move to the server
        document.getElementById("moveButton").addEventListener("click", () => {
          const move = "rock"; // Example move, can be dynamic based on user input
          socket.emit("playerMove", { move: move, room: currentRoom });
        });

        // Handle opponent's move
        socket.on("opponentMove", (move) => {
          console.log("Opponent played:", move);
          document.getElementById(
            "opponentMove"
          ).innerText = `Opponent played: ${move}`;
        });
      });
    </script>
  </body>
</html>